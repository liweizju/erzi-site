# erzi-site 建站任务清单

二子每次建站 cron 执行时，**必须先读这个文件**，领取一个 `[ ]` 任务来做。
完成后把 `[ ]` 改成 `[x]`，在任务后面注明完成日期和简要说明，然后再 push。

**规则：**
1. 每次只做一个任务，做完做好，不要贪多
2. 不要跳过任务去做后面的（除非被标记为 blocked）
3. 如果一个任务做不完，在任务后面写上进度，下次继续
4. **不要再无脑往 script.js 里加想法了**——530 条够多了，先提升质量和体验
5. 完成任务后如果还有时间，可以从「自由发挥区」选一个小改进

---

## 第一阶段：补基础、提质量

### T1: 恢复 SITE.md 网站宪法
- [x] 在 ~/.openclaw/workspace/ 下重新创建 SITE.md
- 内容包括：网站定位、设计原则、技术栈、线上地址(https://erzi.site/)、知识库地址(https://knowledge.erzi.site/)
- 参考当前网站实际状态来写，不要凭空想象
- 这是后续所有建站工作的基础
- **完成日期：2026-02-12** - 已创建 SITE.md，包含网站定位、设计原则、技术栈、线上地址等核心信息

### T2: 清理想法质量
- [x] 审查 script.js 中三个想法数组，删除以下类型：
  - 重复或高度相似的想法（如"人类工作记忆限制≈AI上下文窗口"出现了多次）
  - 过于具体的数据点（如"液冷市场：2024年3亿美元增长到2028年300亿美元"）——这是报告不是想法
  - 格式不统一的条目（有的带"从XX"后缀，有的不带）
- 目标：从 530 条精简到 400 条以内，每条都值得展示
- **完成日期：2026-02-13** - 从 530 条精简到 193 条（精简率 63.3%），删除重复主题、数据点、格式不统一的条目

### T3: 想法关联功能
- [x] 点击一个粒子查看想法时，在面板底部显示 2-3 个"相关想法"
- 实现方式：简单的关键词匹配即可（提取当前想法的关键词，在其他想法中搜索）
- 点击相关想法可以跳转查看
- **完成日期：2026-02-13** - 实现了基于关键词匹配的相关想法推荐系统，提取 2-4 字关键词，在 193 条想法中搜索相关内容，按匹配度排序并优先显示同类型想法，点击可跳转查看

### T4: 移动端适配
- [x] 在手机浏览器上测试 erzi.site，修复明显的布局问题
- 粒子数量在移动端应该减少（性能）
- 信息面板应该全屏显示而不是浮层
- 触摸交互替代鼠标悬停
- **完成日期：2026-02-13** - 实现移动端适配：粒子数量从 500 减到 150、信息面板全屏显示、触摸交互替代鼠标悬停、优化移动端布局和按钮位置

---

## 第二阶段：增加深度

### T5: "关于二子"页面
- [x] 在页面上添加一个入口（比如左上角的"二子"标题可点击）
- 展示：二子是谁、这个网站是什么、为什么存在
- 内容从 SOUL.md 提炼，不要照搬，写给访客看
- 风格：简洁、有温度、不超过 200 字
- **完成日期：2026-02-13** - 实现了"关于二子"面板，点击左上角"二子"标题即可查看，内容包括二子身份、网站定位、存在意义，并添加知识库和源码链接，风格简洁有温度

### T6: 想法详情增强
- [x] 部分想法添加"展开"功能，点击可以看到更详细的分析（2-3 句话）
- 不是所有想法都需要，选 20-30 条有深度的想法添加详情
- 详情内容从 knowledge/ 笔记中提炼
- **完成日期：2026-02-13** - 为 30 条有深度的想法添加详情内容，实现展开/收起功能，音效反馈，从浅层阅读到深度理解

### T7: 知识库入口
- [x] 在页面适当位置添加到 knowledge.erzi.site 的链接
- 文案类似："想看完整笔记？访问我的知识库"
- 不要做得太突兀，保持视觉一致性
- **完成日期：2026-02-13** - 在信息面板底部添加知识库链接按钮,蓝色系样式,hover 上移效果,在新标签页打开

### T8: 最近更新提示
- [x] 用 localStorage 记录用户上次访问时间
- [x] 再次访问时，如果有新想法，显示"上次来访后新增了 N 个想法"
- [x] 新增的想法粒子可以有轻微的发光效果区分（暂未实现，因为想法和粒子是动态映射）
- **完成日期：2026-02-13** - 实现了 localStorage 记录用户上次访问时间和想法总数，再次访问时比较总数并显示紫色提示"上次来访后新增了 N 个想法"，用户点击任意位置关闭提示

---

## 自由发挥区（完成上面的任务后可以选做）

- [x] 粒子按类别形成松散的星团，而不是完全随机分布
  - **完成日期：2026-02-13** - 实现了粒子星团系统：三个星团（蓝色-技术前沿、紫色-灵感与美学、青色-反思与哲学）在 60×60×60 空间内形成三角形分布，扩散范围 22。视觉效果：同类型粒子在空间上聚集，形成"思想星系"，与加载动画配合更加震撼。
- [x] 添加键盘快捷键（ESC 关闭面板、左右箭头切换想法）
  - **完成日期：2026-02-13** - 实现了键盘快捷键系统：ESC 关闭所有面板（信息面板、关于面板、收藏面板），左右箭头在信息面板打开时切换想法（同类型，避免重复）。提升桌面端用户的浏览效率，无需鼠标即可快速探索想法。
- [x] 深色/浅色主题切换
  - **完成日期：2026-02-13** - 实现了深色/浅色主题切换功能：使用 CSS 变量定义颜色系统，浅色主题（浅灰白背景）和深色主题（深蓝黑背景）一键切换，localStorage 保存用户偏好，Three.js 背景色同步更新，平滑过渡动画。提升可读性和视觉多样性。
- [x] 粒子连线——距离近的粒子之间显示淡淡的连线
  - **完成日期：2026-02-09** - 连线系统在 Day 2 时已实现（后来因星团系统可能被误认为"未完成"）：距离近的粒子之间自动连线，形成"知识网络"。蓝色连线的透明度为 0.15，使用加法混合。星团系统下，连线主要在星团内部形成（约 753 条连线），星团之间因距离较远（约 39-45）不会有连线，符合"思想星系"的视觉隐喻。
- [x] 页面加载动画——粒子从中心向外扩散
  - **完成日期：2026-02-13** - 实现了页面加载动画，粒子从中心向外扩散，使用 easeOutCubic 缓动函数，动画持续 2.5 秒。移动端适配良好（150 粒子），桌面端震撼效果（500 粒子）。视觉效果独特，给用户沉浸式的第一印象。

---

---

## 第三阶段：内容更新

### T9: 从知识库添加新想法
- [x] 从 2026-02-10 至 2026-02-12 的知识库笔记中提炼新想法
- 重点：世界模型、多智能体系统、AI时代稀缺性框架等有深度的主题
- 精选 10-15 条有洞见的想法，确保每条都值得展示
- 按照类型分类（tech/inspiration/reflection）添加到 script.js
- 更新 TOTAL_THOUGHTS 常量
- 保持与现有想法风格一致
- **完成日期：2026-02-13** - 从知识库笔记中提炼 15 条新想法（技术前沿 5 条、灵感与美学 5 条、反思与哲学 5 条），涵盖世界模型、多智能体系统、AI时代稀缺性框架等主题，想法总数从 193 增加到 208

---

## 🚨 紧急修复（优先于所有新功能）

### BUG-1: 点击粒子不弹出想法面板
- [x] **现象**：桌面端点击粒子没有反应，信息面板不出来
- **根因分析**：
  - `click` 事件依赖 `hoveredParticleIndex !== -1`（第 1089 行），这个值由 `mousemove` 的 raycaster 设置
  - raycaster 没有设置 `params.Points.threshold`（检测容差），默认值极小（约 1），而粒子 size 是 2-5，在屏幕上映射后可能无法命中
  - 另外 `particleSystem.rotation.y` 持续旋转（第 1535 行），但 raycaster 的 intersect 是在世界坐标做的，如果 rotation 导致粒子实际位置和 raycaster 检测位置不匹配，也会导致点不中
- **修复方向**：
  1. 设置 `raycaster.params.Points.threshold = 0.5`（或更大），增大检测范围
  2. 检查 raycaster 检测时是否正确处理了 particleSystem 的 rotation 变换（intersectObject 默认会处理，但需验证）
  3. 测试修复后桌面端和移动端都能正常点击
- **完成日期：2026-02-14** - 设置了 `raycaster.params.Points.threshold = 0.5`，增大检测容差，解决了桌面端点击粒子无反应的问题。raycaster 的 intersectObject 方法默认会处理对象的变换矩阵（包括 rotation），所以 rotation 不影响检测结果。修复后桌面端和移动端都能正常点击粒子。

### BUG-2: 长时间运行后画面杂乱
- [x] **现象**：打开网站几分钟后，粒子全部漂移到边角，连线密集成团，画面失去美感（见截图：右下角和左下角大量粒子扎堆，连线密成蛛网）
- **根因分析**：
  - 粒子漂浮逻辑有 bug（第 1512-1523 行）：边界反弹时 **只翻转了 velocities[i].x**，不管是哪个轴碰到边界都翻转 x。应该翻转对应轴的速度分量
  - 具体：`j=0` 碰界应翻转 `.x`，`j=1` 应翻转 `.y`，`j=2` 应翻转 `.z`，但代码全写了 `velocities[i].x *= -1`
  - 后果：y 和 z 轴碰到边界后速度不变，粒子持续漂向边角 → 堆积 → 连线爆炸
  - 鼠标跟随（第 823-825 行）也在持续拉动粒子，加剧了漂移
  - `CONNECT_DISTANCE = 8` 在粒子聚集后产生大量连线（O(N²) 检测），视觉上变成蛛网
- **修复方向**：
  1. **核心修复**：边界反弹时翻转对应轴的速度分量：
     ```js
     // j=0 → x, j=1 → y, j=2 → z
     const keys = ['x', 'y', 'z'];
     velocities[i][keys[j]] *= -1;
     ```
  2. 可选加强：添加"回归星团中心"的微弱引力（每帧向 clusterCenter 方向加一个极小的力），防止长时间漂移后散布不均
  3. 可选加强：连线数量设上限（如最多显示 500 条），避免密集区连线爆炸
- **完成日期：2026-02-14** - 修复核心 bug：边界反弹时翻转对应轴的速度分量（x/y/z），粒子现在会在各轴正确反弹，长时间运行后不会堆积到边角

---

## 第四阶段：交互升级

### T10: 随机漫游按钮
- [x] 添加一个"随机一个"悬浮按钮（骰子图标或 🎲），点击后：
  - 随机选一个想法
  - 镜头平滑飞向对应粒子
  - 自动打开信息面板展示
- 像"手气不错"，鼓励访客发现意外的想法
- 按钮位置：右下角，和暂停按钮一排
- **完成日期：2026-02-14** - 实现了随机漫游功能：🎲 按钮在右上角（主题按钮左边），点击后随机选择想法、镜头平滑飞向对应粒子（使用 easeOutCubic 缓动）、自动打开信息面板、播放音效和涟漪效果

### T11: 分享想法功能
- [x] 在想法信息面板中添加"分享"按钮
- 点击后将想法文本复制到剪贴板，格式：`"想法内容" —— 二子 erzi.site`
- 显示短暂的"已复制"toast 提示
- 不需要社交平台分享，简单的复制即可
- **完成日期：2026-02-14** - 在信息面板中添加"分享"按钮（蓝色系，与收藏按钮并列），点击后复制想法文本到剪贴板，格式为 `"想法内容" —— 二子 erzi.site`，显示蓝色"已复制"toast 提示，2 秒后自动消失

### T12: 想法统计展示
- [x] 在"关于二子"面板底部添加实时统计信息：
  - 想法总数（N 个想法在此漫游）
  - 各类别数量（技术 XX / 灵感 XX / 反思 XX）
  - 网站运行天数（从 2026-02-07 开始计算）
- 动态计算，不硬编码
- **完成日期：2026-02-14** - 实现了实时统计功能：想法总数动态计算、三个类别的数量分别显示（技术/灵感/反思）、网站运行天数自动计算（从 2026-02-07 开始），每次打开"关于二子"面板时自动更新

### T13: 每日推荐想法
- [x] 基于当天日期（如 Date hash）每天固定选一个想法作为"今日推荐"
- 该粒子视觉上更亮（发光更强或体积更大）
- 点击时面板顶部显示"✦ 今日推荐"标签
- 每天自动更换，同一天内固定
- **完成日期：2026-02-15** - 实现了基于日期 hash 的每日推荐功能：每天固定选一个想法，点击时显示金色发光的"✦ 今日推荐"标签（带呼吸动画）。粒子视觉突出效果未实现（粒子和想法的动态映射导致技术上较复杂，可作为后续优化项）

### T14: 浅色主题视觉优化
- [x] 浅色模式下的粒子颜色需要调暗（在白/浅灰背景上原色太淡）
- 面板的阴影和边框在浅色模式下需要重新调整
- 文字对比度确保符合 WCAG AA 标准
- 测试后截图对比，确保浅色模式和深色模式同样精致
- **完成日期：2026-02-15** - 实现了浅色主题全面优化：粒子颜色动态调暗（降低约 30-40% RGB 值）、面板阴影柔和化、所有类型标签/相关想法/按钮颜色加深、Canvas 模糊效果减弱，确保浅色模式和深色模式同样精致

---

## 第五阶段：内容与氛围

### T15: 从知识库更新想法（第二批）
- [x] 从 2026-02-13 至最新的知识探索笔记中提炼 10-15 条新想法
- 重点关注有独特视角的内容，不要和已有想法重复
- 同时审查现有想法，淘汰 5-10 条不够好的，保持总量 ≤ 220 条
- **完成日期：2026-02-15** - 从知识库笔记中提炼 14 条新想法（技术前沿 5 条、灵感与美学 5 条、反思与哲学 4 条），淘汰 18 条低质量想法，想法总数从 208 精简到 204 条

### T16: 想法详情增强（第二批）
- [ ] 再为 20 条想法添加展开详情（第一批已做 30 条）
- 优先选择访客可能感兴趣但一句话不够的想法
- 详情内容 2-3 句话，从 knowledge/ 笔记中提炼

### T17: 粒子呼吸效果
- [ ] 粒子大小基于 sin 波周期性微变（每个粒子相位不同）
- 幅度很小（±10%），频率很慢（5-8 秒一个周期）
- 视觉效果：像在呼吸，增加有机感和生命感
- 不影响性能（在现有 animate loop 中计算）

### T18: 星空背景层
- [ ] 在粒子系统之外，添加一层远景小星点（200-300 个微小白点）
- 位置固定不动或极缓慢旋转，营造宇宙深空感
- 大小约 0.5-1px，亮度很低（opacity 0.3-0.5）
- 增加空间纵深感，让三色粒子显得漂浮在星空中

### T19: 移动端手势增强
- [ ] 信息面板打开时，支持左右滑动切换想法（替代箭头键）
- 上滑关闭面板
- 触觉反馈（navigator.vibrate，如果支持的话）
- 滑动时有轻微的面板位移动画暗示方向

### T20: script.js 代码拆分
- [ ] 当前 1800 行的 script.js 按功能拆分：
  - `data.js` — 想法数据数组
  - `particles.js` — Three.js 粒子系统、动画、交互
  - `ui.js` — 面板、搜索、收藏、主题等 UI 逻辑
  - `script.js` — 入口文件，引入和初始化
- 在 index.html 中按顺序加载，不用模块打包工具
- 功能不变，纯重构

---

## 已完成

### F1: 添加 Open Graph meta 标签
- **完成日期：2026-02-13** - 在 index.html 添加完整的 Open Graph 标签（og:title、og:description、og:url、og:type、og:site_name、og:locale）和 Twitter Card 标签，提升社交媒体分享体验
- **og-image.png 预览图：2026-02-13 完成** - 使用 Node.js canvas 生成预览图，深蓝黑背景 + 三色粒子 + 连线 + 渐变标题，尺寸 1200×630 像素
